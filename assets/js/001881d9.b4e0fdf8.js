"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7864],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>h});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var i=a.createContext({}),p=function(e){var n=a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(i.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(t),m=r,h=d["".concat(i,".").concat(m)]||d[m]||u[m]||o;return t?a.createElement(h,s(s({ref:n},c),{},{components:t})):a.createElement(h,s({ref:n},c))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,s=new Array(o);s[0]=m;var l={};for(var i in n)hasOwnProperty.call(n,i)&&(l[i]=n[i]);l.originalType=e,l[d]="string"==typeof e?e:r,s[1]=l;for(var p=2;p<o;p++)s[p]=t[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},13469:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=t(87462),r=(t(67294),t(3905));const o={},s="L18 Node and SQL",l={unversionedId:"lectures/node-sql/index",id:"lectures/node-sql/index",title:"L18 Node and SQL",description:"Overview",source:"@site/docs/03-lectures/18-node-sql/index.md",sourceDirName:"03-lectures/18-node-sql",slug:"/lectures/node-sql/",permalink:"/docs/lectures/node-sql/",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"L17 ACID and SQL",permalink:"/docs/lectures/acid-sql/"},next:{title:"L19 NoSQL",permalink:"/docs/lectures/no-sql/"}},i={},p=[{value:"Overview",id:"overview",level:2},{value:"The <code>env</code> Package",id:"the-env-package",level:2},{value:"Slides",id:"slides",level:2},{value:"Code Examples",id:"code-examples",level:2},{value:"Exercise",id:"exercise",level:2},{value:"VSCode",id:"vscode",level:3}],c={toc:p};function d(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"l18-node-and-sql"},"L18 Node and SQL"),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"If you're looking to build a web application with Node.js, using the Express framework and a PostgreSQL database, the pg module is an excellent choice for managing your database interactions. In this post, we'll go over how to use the pg module with Express to create, read, update, and delete data from a PostgreSQL database."),(0,r.kt)("p",null,"First, we need to install the pg module using npm:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install pg\n")),(0,r.kt)("p",null,"Next, we'll create a new Express application and set up a connection to our PostgreSQL database. In this example, we'll assume that you have already created a database named ",(0,r.kt)("inlineCode",{parentName:"p"},"myapp")," and a table named ",(0,r.kt)("inlineCode",{parentName:"p"},"users"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const express = require('express');\nconst { Pool } = require('pg');\n\nconst app = express();\n\nconst pool = new Pool({\n  user: 'postgres',\n  host: 'localhost',\n  database: 'myapp',\n  password: 'password',\n  port: 5432,\n});\n\napp.get('/users', async (req, res) => {\n  try {\n    const { rows } = await pool.query('SELECT * FROM users');\n    res.send(rows);\n  } catch (error) {\n    console.log(error);\n    res.status(500).send('Error retrieving users from database');\n  }\n});\n\napp.post('/users', async (req, res) => {\n  const { name, email } = req.body;\n  try {\n    const { rows } = await pool.query(\n      'INSERT INTO users (name, email) VALUES ($1, $2) RETURNING *',\n      [name, email]\n    );\n    res.send(rows[0]);\n  } catch (error) {\n    console.log(error);\n    res.status(500).send('Error adding user to database');\n  }\n});\n\napp.put('/users/:id', async (req, res) => {\n  const { name, email } = req.body;\n  const { id } = req.params;\n  try {\n    const { rows } = await pool.query(\n      'UPDATE users SET name=$1, email=$2 WHERE id=$3 RETURNING *',\n      [name, email, id]\n    );\n    res.send(rows[0]);\n  } catch (error) {\n    console.log(error);\n    res.status(500).send('Error updating user in database');\n  }\n});\n\napp.delete('/users/:id', async (req, res) => {\n  const { id } = req.params;\n  try {\n    const { rows } = await pool.query('DELETE FROM users WHERE id=$1 RETURNING *', [\n      id,\n    ]);\n    res.send(rows[0]);\n  } catch (error) {\n    console.log(error);\n    res.status(500).send('Error deleting user from database');\n  }\n});\n\napp.listen(3000, () => console.log('Server running on port 3000'));\n")),(0,r.kt)("p",null,"In this example, we're using the ",(0,r.kt)("inlineCode",{parentName:"p"},"Pool")," object provided by the ",(0,r.kt)("inlineCode",{parentName:"p"},"pg")," module to manage our database connections. The ",(0,r.kt)("inlineCode",{parentName:"p"},"Pool")," object automatically manages a pool of connections to our PostgreSQL database, making it easy to reuse connections and avoid creating new ones for each request."),(0,r.kt)("p",null,"We then define our routes for retrieving, creating, updating, and deleting users from our database. Each route uses the ",(0,r.kt)("inlineCode",{parentName:"p"},"pool.query()")," method to execute an SQL query on our database. The ",(0,r.kt)("inlineCode",{parentName:"p"},"pool.query()")," method returns a ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise")," that resolves to an object containing the results of the query, including the rows returned by the query."),(0,r.kt)("p",null,"Note that we're using async/await syntax to handle asynchronous operations in a more readable way. We're also using error handling to catch any errors that may occur when querying the database and returning an appropriate error response to the client."),(0,r.kt)("h2",{id:"the-env-package"},"The ",(0,r.kt)("inlineCode",{parentName:"h2"},"env")," Package"),(0,r.kt)("p",null,"If you're building a Node.js application, you might need to use environment variables to store configuration values that should not be hardcoded into your code. The env package in npm makes it easy to manage environment variables in your Node.js applications."),(0,r.kt)("p",null,"To get started, you can install the ",(0,r.kt)("inlineCode",{parentName:"p"},"env")," package using npm:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install env\n")),(0,r.kt)("p",null,"Once installed, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"env")," package to load environment variables from a ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file in the root of your project. The ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file should contain key-value pairs of your environment variables in the format ",(0,r.kt)("inlineCode",{parentName:"p"},"KEY=VALUE"),". For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"DATABASE_URL=postgres://user:password@localhost:5432/myapp\nAPI_KEY=1234567890\n")),(0,r.kt)("p",null,"To load these environment variables into your application, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"env.config()")," method provided by the ",(0,r.kt)("inlineCode",{parentName:"p"},"env")," package. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const env = require('env');\n\nenv.config();\n\nconsole.log(process.env.DATABASE_URL);\nconsole.log(process.env.API_KEY);\n")),(0,r.kt)("p",null,"In this example, we're calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"env.config()")," method to load environment variables from our ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file. We can then access these environment variables using the ",(0,r.kt)("inlineCode",{parentName:"p"},"process.env")," object."),(0,r.kt)("p",null,"If you need to set environment variables programmatically, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"env.set()")," method provided by the env package. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const env = require('env');\n\nenv.set('DATABASE_URL', 'postgres://user:password@localhost:5432/myapp');\nenv.set('API_KEY', '1234567890');\n\nconsole.log(process.env.DATABASE_URL);\nconsole.log(process.env.API_KEY);\n")),(0,r.kt)("p",null,"In this example, we're using the ",(0,r.kt)("inlineCode",{parentName:"p"},"env.set()")," method to set environment variables ",(0,r.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"API_KEY")," programmatically. We can then access these environment variables using the ",(0,r.kt)("inlineCode",{parentName:"p"},"process.env")," object."),(0,r.kt)("p",null,"Using the ",(0,r.kt)("inlineCode",{parentName:"p"},"env")," package in your Node.js applications makes it easy to manage environment variables and keep your configuration values separate from your code. It's a simple and effective way to keep your code clean and maintainable."),(0,r.kt)("h2",{id:"slides"},"Slides"),(0,r.kt)("iframe",{src:"https://docs.google.com/presentation/d/e/2PACX-1vSyFiSVG3-PmRtmnbw9P5ZDFknNDxGgoLxpEtC0_AL46fCU23sZNbV-hZlctdo87ZoHmdehzhIYQ1DO/embed?start=false&loop=false&delayms=3000",frameborder:"0",width:"1280",height:"749",allowfullscreen:"true",mozallowfullscreen:"true",webkitallowfullscreen:"true"}),(0,r.kt)("p",null,"The slide deck can be found ",(0,r.kt)("a",{parentName:"p",href:"https://docs.google.com/presentation/d/15X2qp1-ld1YTNaUmdARqOycOhjNju2TdtCOu5AfAQ2I/edit?usp=sharing"},"here"),"."),(0,r.kt)("p",null,"The Jamboard can be found ",(0,r.kt)("a",{parentName:"p",href:"https://jamboard.google.com/d/1VAzX3N0mxiZ7ICyrouMqAB7o9M35MECcEmCMlrWXsr8/edit?usp=share_link"},"here"),"."),(0,r.kt)("h2",{id:"code-examples"},"Code Examples"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/umass-cs-326/examples/tree/main/17-acid-and-sql"},"examples/18-node-sql"))),(0,r.kt)("p",null,"You can view all of the examples by cloning the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/umass-cs-326/examples"},"examples repository"),"."),(0,r.kt)("h2",{id:"exercise"},"Exercise"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"NO EXERCISE"),", but you should really practice this stuff!"),(0,r.kt)("h3",{id:"vscode"},"VSCode"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer"},"VSCode Live Server"),", an extension we will end up using quite a bit for several weeks."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://marketplace.visualstudio.com/items?itemName=ckolkman.vscode-postgres"},"PostgreSQL"),", an extension that allows you to connect to a PostgreSQL database and run queries.")))}d.isMDXComponent=!0}}]);